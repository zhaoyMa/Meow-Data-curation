from typing import Dict, List, Tuple, Set, Any, Optional
import math
from collections import defaultdict


def f_beta(pred_list: list[str], true_list: list[str], beta=0.5, eps=1e-8) -> float:
    pred_set = set(pred_list)
    true_set = set(true_list)
    tp = len(pred_set & true_set)
    P = tp / (len(pred_list) + eps)
    R = tp / (len(true_list) + eps)
    b2 = beta * beta
    return (1 + b2) * P * R / (b2 * P + R + eps)

# thresh 为不扣分的阈值，30 为最大容忍阈值-thresh
def len_penalty(n: int, thresh=30, lam_quad=1.0/(30**2)) -> float:
    d = max(0, n - thresh)
    lam_quad = 1.0/(thresh**2)
    return min(lam_quad * (d ** 2),1)

def len_penalty_linear(n: int, thresh=30, lam_lin=1.0/30) -> float:
    d = max(0, n - thresh)
    lam_lin = 1.0 / thresh
    return min(lam_lin * d, 1.0)


def section_reward_from_refs(pred_refs: List[str], true_refs: List[str],
                             beta=0.5, Lmax=30 ) -> Dict[str, Any]:
    """
    单章节奖励（matched）
    返回 dict 包含 precision, recall, f_beta, len_penalty, reward
    reward = f_beta - len_penalty(len(pred_refs))
    """
    f = f_beta(pred_refs, true_refs, beta)
    pen = len_penalty(len(pred_refs), Lmax)
    reward = f - pen
    # clip reward 可以考虑但按公式不强制裁剪
    return {
        "precision_recall_fbeta": None,  # 保留位置以便扩展
        "f_beta": f,
        "len_pen": pen,
        "reward": reward,
        "pred_len": len(pred_refs),
        "true_len": len(true_refs)
    }


def make_section_map(sections: List[Dict[str, Any]]) -> Dict[str, List[str]]:
    """
    将 section 列表 转换成 id -> ref_list 映射
    id 的决定顺序： 'numbering' > 'title' > index
    每项确保返回 list[str] （若没有 'ref' 或为 None 则视为空列表）
    """
    mapping: Dict[str, List[str]] = {}
    for i, sec in enumerate(sections):
        if isinstance(sec, dict):
            if 'numbering' in sec and sec.get('numbering') not in (None, ""):
                sid = f"num:{sec['numbering']}"
            elif 'title' in sec and sec.get('title') not in (None, ""):
                sid = f"title:{sec['title']}"
            else:
                sid = f"idx:{i}"
            refs = sec.get('ref', []) or []
            # 保证全是字符串
            refs = [str(r) for r in refs]
            mapping[sid] = refs
        else:
            # 非 dict 的项，按索引命名并尝试转成 list[str]
            sid = f"idx:{i}"
            try:
                refs = list(sec)
                refs = [str(r) for r in refs]
            except Exception:
                refs = []
            mapping[sid] = refs
    return mapping

def greedy_match_by_numbering(gen_map: Dict[str, List[str]],
                              true_map: Dict[str, List[str]]
                              ) -> Tuple[List[Tuple[str, str]], List[str], List[str]]:
    """
    按 numbering 字段 (我们在 make_section_map 中用 'num:<numbering>' 作为 key) 进行一对一匹配。
    - 如果同一个 numbering 在两边都有多条记录，则按出现顺序一一配对（最多 min(len(gen_list), len(true_list)) 对）。
    - 不含 numbering 的条目（如 'title:' 或 'idx:' 开头的 key）不会被匹配，归为 unmatched。
    返回 (pairs, unmatched_true_ids, unmatched_gen_ids)
    """
    # build numbering -> list of ids
    gen_by_num = defaultdict(list)   # num -> [gen_id, ...]
    true_by_num = defaultdict(list)  # num -> [true_id, ...]
    # also collect all ids
    all_gen_ids = list(gen_map.keys())
    all_true_ids = list(true_map.keys())

    # helper to extract numbering from key built by make_section_map
    def extract_numbering(key: str) -> str:
        if key.startswith("num:"):
            return key[len("num:"):]
        return None

    for gid in all_gen_ids:
        num = extract_numbering(gid)
        gen_by_num[num].append(gid)

    for tid in all_true_ids:
        num = extract_numbering(tid)
        true_by_num[num].append(tid)

    pairs: List[Tuple[str, str]] = []
    used_gen = set()
    used_true = set()

    # 对存在于两边的 numbering 做一对一配对
    common_nums = set(gen_by_num.keys()) & set(true_by_num.keys())
    # 排除 None（即无 numbering 的条目），因为我们不按照 title/index 匹配
    if None in common_nums:
        common_nums.remove(None)

    for num in common_nums:
        gen_list = gen_by_num[num]
        true_list = true_by_num[num]
        m = min(len(gen_list), len(true_list))
        for i in range(m):
            gid = gen_list[i]
            tid = true_list[i]
            pairs.append((gid, tid))
            used_gen.add(gid)
            used_true.add(tid)

    # unmatched：那些没有被配到的一方全部视为 unmatched
    unmatched_true = [tid for tid in all_true_ids if tid not in used_true]
    unmatched_gen = [gid for gid in all_gen_ids if gid not in used_gen]

    return pairs, unmatched_true, unmatched_gen

def article_reward(gen_sections: List[Dict[str, Any]],
                   true_sections: List[Dict[str, Any]],
                   beta=0.5,
                   Lmax: Optional[int] = None,
                   lam: Optional[float] = None,
                   quadratic: bool = True,
                   average: bool = True,
                   return_details: bool = True) -> Tuple[float, Optional[Dict[str, Any]]]:
    """
    计算整篇文章的奖励：
      gen_sections, true_sections: List[Dict]（每个 dict 含 'ref' 字段）
    参数：
      - beta: F_beta 的 beta
      - Lmax: 扣分阈值（若为 None，则取 true_sections 中 ref 长度的最大值，若 M==0 则默认 30）
      - lam: 惩罚系数（若为 None 会根据 Lmax 自动设定）
      - quadratic: True 使用二次惩罚，否则线性
      - average: 是否按真实章节数 N 归一化（题目要求按 N）
      - return_details: 是否返回每章节明细
    返回:
      (R_article, details_dict or None)
    """
    gen_map = make_section_map(gen_sections)
    true_map = make_section_map(true_sections)
    true_norefs = 0
    # 确定 Lmax , 规定 Lmax 最多为 10
    if Lmax is None:
        # 以 true 中最大 ref 长度为阈值（如题中建议）
        max_true_len = 0
        for refs in true_map.values():
            max_true_len = max(max_true_len, len(refs))
            if len(refs) == 0:
                true_norefs = true_norefs+1
        Lmax = max_true_len if max_true_len > 0 else 30
        #print(f"Lmax{Lmax}")
    Lmax = max(Lmax, 10)
    # 计算 num 级的匹配度
    pairs, missed_true, spurious_gen = greedy_match_by_numbering(gen_map, true_map)

    N_true = max(1, len(true_map)-true_norefs)  # 避免除零；但题中 N 为真实章节数
    total = 0.0
    details = {
        "matched": [],
        "missed": [],
        "spurious": [],
        "N_true": len(true_map),
        "N_gen": len(gen_map)
    }

    # 已匹配章节：R_i = Fbeta(pred_i,true_i) - LenPen(|pred_i|)
    for gid, tid in pairs:
        pred_refs = gen_map.get(gid, [])
        true_refs = true_map.get(tid, [])
        sec = section_reward_from_refs(pred_refs, true_refs, beta, Lmax)
        total += sec["reward"]
        details["matched"].append({
            "gen_id": gid, "true_id": tid,
            "pred_len": sec["pred_len"], "true_len": sec["true_len"],
            "f_beta": sec["f_beta"], "len_pen": sec["len_pen"], "reward": sec["reward"]
        })

    # 漏章节惩罚： R_miss = -LenPen(|true_i|)
    for tid in missed_true:
        true_refs = true_map.get(tid, [])
        pen = len_penalty(len(true_refs), Lmax)
        r = -pen
        total += r
        details["missed"].append({"true_id": tid, "true_len": len(true_refs), "len_pen": pen, "reward": r})

    # 虚假章节惩罚： R_spurious = -LenPen(|pred_i|)
    for gid in spurious_gen:
        pred_refs = gen_map.get(gid, [])
        pen = len_penalty(len(pred_refs), Lmax)
        r = -pen
        total += r
        details["spurious"].append({"gen_id": gid, "pred_len": len(pred_refs), "len_pen": pen, "reward": r})

    R_article = (total / N_true) if average else total
    R_article = max(-1,R_article)
    if return_details:
        details["R_article"] = R_article
        details["total_raward"] = total
        return R_article, details
    else:
        return R_article, None

# -------------------------
# 示例（可直接运行检验）
# -------------------------
if __name__ == "__main__":
    # 非常极端的示例
    pred = [{'level': 1, 'numbering': '1', 'title': 'Introduction', 'ref': ['liu2024visual', 'zhu2023minigpt', 'dubey2024llama32', 'gpt4v', 'team2023gemini', 'brown2020language', 'touvron2023llama', 'touvron2023llama2', 'chiang2023vicuna', 'bai2023qwen', 'krizhevsky2012imagenet', 'simonyan2014very', 'he2016deep', 'tan2019efficientnet', 'redmon2016you', 'wang2020minivlm', 'wang2021simvlm', 'alayrac2022flamingo', 'anthropic2024claude', 'dosovitskiy2021image', 'singh2022flava', 'lu2019vilbert', 'li2019visualbert', 'zhou2020unified', 'zhang2024rethinking', 'duan2022multi', 'radford2021learning', 'li2022blip', 'jia2021scaling', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'zhu2024unraveling', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'ma2020addressing', 'dingimp', 'shang2024pixels', 'liu2407paying', 'huang2024opera', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'li2024monkey', 'parashar2024neglected', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'shi2024assessment', 'maharana2023exposing', 'zhao2024opening', 'zhao2024explainability', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 2, 'numbering': '1.1', 'title': 'Introduction of VLMs', 'ref': []}, {'level': 2, 'numbering': '1.2', 'title': 'Cross-modal Misalignment in LVLMs', 'ref': ['liu2024visual', 'zhu2023minigpt', 'dubey2024llama32', 'gpt4v', 'team2023gemini', 'brown2020language', 'touvron2023llama', 'touvron2023llama2', 'chiang2023vicuna', 'bai2023qwen', 'krizhevsky2012imagenet', 'simonyan2014very', 'he2016deep', 'tan2019efficientnet', 'redmon2016you', 'wang2020minivlm', 'wang2021simvlm', 'alayrac2022flamingo', 'anthropic2024claude', 'dosovitskiy2021image', 'singh2022flava', 'lu2019vilbert', 'li2019visualbert', 'zhou2020unified', 'zhang2024rethinking', 'duan2022multi', 'radford2021learning', 'li2022blip', 'jia2021scaling', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'zhu2024unraveling', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'ma2020addressing', 'dingimp', 'shang2024pixels', 'liu2407paying', 'huang2024opera', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'li2024monkey', 'parashar2024neglected', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'shi2024assessment', 'maharana2023exposing', 'zhao2024opening', 'zhao2024explainability', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 2, 'numbering': '1.3', 'title': 'Related Surveys and Challenges', 'ref': []}, {'level': 1, 'numbering': '2', 'title': 'Hallucination in LVLMs', 'ref': ['fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'zhao2024explainability', 'zhao2024opening', 'bordes2024introduction', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'li2023silkie', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'sun2023aligning', 'fu2023mme', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'li2023silkie', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 2, 'numbering': '2.1', 'title': 'Misalignment Causes', 'ref': ['fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'zhao2024explainability', 'zhao2024opening', 'bordes2024introduction', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'li2023silkie', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'sun2023aligning', 'fu2023mme', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'li2023silkie', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 3, 'numbering': '2.1.1', 'title': 'Theoretical Analysis', 'ref': ['fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'zhao2024explainability', 'zhao2024opening', 'bordes2024introduction', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'li2023silkie', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'sun2023aligning', 'fu2023mme', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'li2023silkie', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 3, 'numbering': '2.1.2', 'title': 'Empirical Analysis', 'ref': ['fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 2, 'numbering': '2.2', 'title': 'Detection', 'ref': ['zhu2023minigpt', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'liu2024survey', 'bai2024hallucination', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 3, 'numbering': '2.2.1', 'title': 'Rule-based Detection Methods', 'ref': ['yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'liu2024survey', 'zhu2023minigpt', 'bai2024hallucination']}, {'level': 3, 'numbering': '2.2.2', 'title': 'Model-based Detection Methods', 'ref': ['zhu2023minigpt', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'liu2024survey', 'bai2024hallucination', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 2, 'numbering': '2.3', 'title': 'Mitigation', 'ref': ['zhu2023minigpt', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'liu2024survey', 'bai2024hallucination', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 3, 'numbering': '2.3.1', 'title': 'Training and Data-based Methods', 'ref': ['yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 3, 'numbering': '2.3.2', 'title': 'Decoding-based Methods', 'ref': ['fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 1, 'numbering': '3', 'title': 'Methodology', 'ref': ['fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 2, 'numbering': '3.1', 'title': 'Datasets', 'ref': ['fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination']}, {'level': 2, 'numbering': '3.2', 'title': 'Metrics', 'ref': ['fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 1, 'numbering': '4', 'title': 'Analysis of Hallucination', 'ref': ['zhu2023minigpt', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 2, 'numbering': '4.1', 'title': 'Hallucination in Different Modalities', 'ref': ['yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'liu2024survey', 'zhu2023minigpt', 'bai2024hallucination', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 2, 'numbering': '4.2', 'title': 'Impact of Training Data', 'ref': ['zhu2023minigpt', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 2, 'numbering': '4.3', 'title': 'Effectiveness of Mitigation Methods', 'ref': ['fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}, {'level': 1, 'numbering': '5', 'title': 'Conclusion and Future Directions', 'ref': ['zhu2023minigpt', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'zhu2024unraveling', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'zhu2024unraveling', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'hu2023ciem', 'liu2023mitigating', 'li2024enhancing', 'bordes2024introduction', 'wang2024valid', 'ghosh2024visual', 'chen2023retrieval', 'ramos2023lmcap', 'ramos2023smallcap', 'sarto2024towards', 'kim2024if', 'deng2024seeing', 'yang2024pensieve', 'zhao2024mitigating', 'li2024visual', 'kim2024code', 'yuksekgonul2022and', 'huang2024relationvlm', 'guo2024regiongpt', 'gou2024well', 'you2023ferret', 'sharma2024vision', 'li2024monkey', 'parashar2024neglected', 'ozaki2024towards', 'byun2024mafa', 'liang2022mind', 'ouali2025clip', 'manevich2024mitigating', 'wang2024mllm', 'woo2024ritual', 'wang2024mitigating', 'qu2024alleviating', 'gong2024damro', 'liu2024reducing', 'zhai2023halle', 'chen2024ict', 'li2023silkie', 'han2024skip', 'yue2024less', 'zhu2024ibd', 'chen2024halc', 'xie2024v', 'wang2024rovrm', 'feng2024more', 'an2024agla', 'zhong2024investigating', 'favero2024multi', 'zhang2025reflective', 'tang2024textsquare', 'cha2024visually', 'liu2024mminstruct', 'Qwen-VL', 'wu2024deepseekvl2mixtureofexpertsvisionlanguagemodels', 'yuan2025tarsier2', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'ma2020addressing', 'dingimp', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'li2023evaluating', 'xu2024lvlm', 'yan2024list', 'huo2024self', 'min2024mitigating', 'woo2024don', 'chen2025image', 'huang2024learn', 'zhou2023learning', 'shang2024pixels', 'sharma2024vision', 'neo2024towards', 'zhao2024beyond', 'changpinyo2021conceptual', 'park2024mitigating', 'zhao2024evaluating', 'qu2024mitigating', 'yang2022vision', 'shu2024exploring', 'maniparambil2024vision', 'li2024vision', 'huh2024platonic', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'zhu2024unraveling', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey', 'bai2024hallucination', 'fu2023mme', 'fu2023mmvet', 'yu2024hallucidoctor', 'wu2024logical', 'xiao2024detecting', 'fieback2024metatoken', 'dai2022plausible', 'lee2023volcano', 'chen2023mitigating', 'wang2024mitigating2', 'ben2024mitigating', 'rohrbach2018object', 'yu2024rlhf', 'sun2023aligning', 'leng2024mitigating', 'zhou2023analyzing', 'yin2023woodpecker', 'Yu_Jalaian_Bastian_2024', 'zhao2023beyond', 'zhou2024aligning', 'zhu2023minigpt', 'liu2024survey']}]
    true = [{'level': 1, 'numbering': '1', 'title': 'Introduction', 'ref': []}, {'level': 1, 'numbering': '2', 'title': 'Alignment of LVLMs', 'ref': []}, {'level': 2, 'numbering': '2.1', 'title': 'What is Alignment?', 'ref': []}, {'level': 2, 'numbering': '2.2', 'title': 'How is Alignment Achieved?', 'ref': []}, {'level': 2, 'numbering': '2.3', 'title': 'Why is Alignment Possible?', 'ref': []}, {'level': 1, 'numbering': '3', 'title': 'Misalignment of LVLMs', 'ref': ['gpt4v', 'team2023gemini', 'liu2024visual', 'anthropic2024claude', 'wang2024qwen2', 'dubey2024llama', 'brown2020language', 'touvron2023llama', 'touvron2023llama2', 'bai2023qwen', 'dosovitskiy2021image', 'radford2021learning', 'liu2024survey', 'jia2021scaling', 'yang2022vision', 'shu2024exploring', 'zhang2024rethinking', 'zhou2024aligning', 'zhao2024survey', 'meta2024llama32', 'huh2024platonic', 'maniparambil2024vision', 'sharma2024vision', 'neo2024towards', 'wang2023evaluation', 'li2023evaluating', 'shang2024pixels', 'wu2024evaluating', 'ouali2025clip', 'shi2024assessment', 'li2024enhancing', 'chen2025image', 'min2024mitigating', 'woo2024don', 'zhou2023learning', 'huang2024learn', 'zhu2024unraveling', 'ghosh2024visual']}, {'level': 2, 'numbering': '3.1', 'title': 'Definition of Misalignment', 'ref': []}, {'level': 2, 'numbering': '3.2', 'title': 'Reasons of Misalignment', 'ref': ['gpt4v', 'team2023gemini', 'liu2024visual', 'anthropic2024claude', 'wang2024qwen2', 'dubey2024llama', 'brown2020language', 'touvron2023llama', 'touvron2023llama2', 'bai2023qwen', 'dosovitskiy2021image', 'radford2021learning', 'liu2024survey', 'jia2021scaling', 'yang2022vision', 'shu2024exploring', 'zhang2024rethinking', 'zhou2024aligning', 'zhao2024survey', 'meta2024llama32', 'huh2024platonic', 'maniparambil2024vision', 'sharma2024vision', 'neo2024towards', 'wang2023evaluation', 'li2023evaluating', 'shang2024pixels', 'wu2024evaluating', 'ouali2025clip', 'shi2024assessment', 'li2024enhancing', 'chen2025image', 'min2024mitigating', 'woo2024don', 'zhou2023learning', 'huang2024learn', 'zhu2024unraveling', 'ghosh2024visual']}, {'level': 3, 'numbering': '3.2.1', 'title': 'Dataset Level', 'ref': ['gpt4v', 'team2023gemini', 'liu2024visual', 'anthropic2024claude', 'wang2024qwen2', 'dubey2024llama', 'brown2020language', 'touvron2023llama', 'touvron2023llama2', 'bai2023qwen', 'dosovitskiy2021image', 'radford2021learning', 'liu2024survey', 'jia2021scaling', 'yang2022vision', 'shu2024exploring']}, {'level': 3, 'numbering': '3.2.2', 'title': 'Model Level', 'ref': ['radford2021learning', 'meta2024llama32', 'huh2024platonic', 'maniparambil2024vision', 'sharma2024vision', 'neo2024towards', 'liu2024survey', 'wang2023evaluation', 'li2023evaluating', 'shang2024pixels', 'wu2024evaluating', 'ouali2025clip', 'shi2024assessment', 'li2024enhancing', 'chen2025image', 'min2024mitigating', 'woo2024don', 'zhou2024aligning', 'zhou2023learning', 'huang2024learn', 'zhu2024unraveling', 'ghosh2024visual']}, {'level': 3, 'numbering': '3.2.3', 'title': 'Inference Level', 'ref': []}, {'level': 1, 'numbering': '4', 'title': 'Mitigation Methods', 'ref': []}, {'level': 2, 'numbering': '4.1', 'title': 'Parameter Tuning Alignment', 'ref': []}, {'level': 2, 'numbering': '4.2', 'title': 'Parameter Frozen Alignment', 'ref': []}, {'level': 1, 'numbering': '5', 'title': 'Conclusions', 'ref': ['hu2023ciem', 'jiang2024hallucination']}]

    score, det = article_reward(pred, true, beta=0.5, Lmax=None, quadratic=True, return_details=True)
    print("R_article:", score)
    import json
    print(json.dumps(det, indent=2, ensure_ascii=False))